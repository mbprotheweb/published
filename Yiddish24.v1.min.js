function downloadBlob(b,c="km-download.mp3"){let d=URL.createObjectURL(b),a=document.createElement("a");a.href=d,a.download=c,document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(a)}function dl(c){var d,a=c.target.parentElement.parentElement.parentElement,b=a.getAttribute("data-song-url");try{d=a.parentElement.querySelector("h1").textContent+" - "+a.parentElement.querySelector("p").textContent}catch(e){d=a.getElementsByClassName("post-title")[0].innerHTML}null==b&&(b=c.target.parentElement.parentElement.getAttribute("data-song-url")),fetch(b).then(a=>a.blob()).then(a=>downloadBlob(a,d+".mp3"))}function setit(){var a=document.getElementsByClassName("playing-panel");[].forEach.call(a,function(b){if(!(b.getElementsByClassName("cutitout").length>0)){var a=document.createElement("a");a.classList.add("cutitout"),a.addEventListener("click",dl),a.innerHTML=" Download";try{b.getElementsByClassName("play_button")[0].prepend(a)}catch(c){try{b.getElementsByClassName("playBtn")[0].prepend(a)}catch(d){return}}}})}document.body.addEventListener("DOMSubtreeModified",function(){setit()}),setit()
